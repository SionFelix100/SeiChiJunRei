# 日本动漫圣地巡礼可视化项目

基于Cesium.js的3D数字城市可视化平台，专注于日本动漫圣地巡礼体验，以东京千代田区为核心展示区域。

## 🌟 项目概述

本项目是一个专注于日本动漫圣地巡礼的3D数字城市可视化平台，以东京千代田区为核心展示区域。项目基于Cesium.js技术，集成了精细的城市3D Tiles模型、OSM模型、智能底图切换、相机视角变换、动漫取景地数据和沉浸式导览等功能，为动漫爱好者提供虚拟圣地巡礼体验。用户可以在高精度的3D城市环境中探索知名动漫作品的取景地，通过一键导航功能快速到达指定地点，并利用收藏夹功能管理个人感兴趣的圣地，为动漫文化的传播和推广提供了全新的数字化体验方式，让用户足不出户即可感受动漫世界的魅力。

## 🚀 核心亮点

### 智能化3D数据展示
- **建筑模型**: LOD1/LOD2级别的精细建筑，支持基于高度的六级颜色渐变（红色→橙色→黄色→黄绿色→绿色→蓝色）
- **多类型模型**: 水系、桥梁、交通、城市家具、植被、地下建筑、高程数据等，各具主题色彩
- **统一透明度**: 所有模型设置90%不透明度，保持视觉一致性

### 智能底图切换系统
- **多样化底图**: 地形、OpenStreetMap、Stadia Alidade Smooth Dark、Stadia x Stamen Toner
- **智能联动**: 加载千代田3D Tiles时自动切换到Stadia Dark底图
- **一键清除**: 快速恢复默认样式功能

### 沉浸式交互体验
- **多视角相机**: 3D/2.5D/2D模式自由切换
- **天气模拟**: 雨天、雪天、雾天等逼真天气效果
- **空间分析**: 距离测量、面积计算、缓冲区分析、高度测量
- **动漫圣地巡礼**: 内置东京知名动漫取景地数据，支持收藏和导航

## 🛠️ 技术架构

### 技术栈
- **前端框架**: JavaScript + HTML5 + CSS3
- **3D引擎**: Cesium.js 1.95+
- **数据格式**: 3D Tiles、MVT（Mapbox Vector Tiles）
- **服务器**: Python HTTP Server（开发环境）
- **数据源**: 千代田区官方CityGML数据转换的3D Tiles
- **数据存储**: 阿里云OSS

### 核心模块
1. **主视图管理** (`viewer.js`)
   - Cesium视图初始化
   - 默认视角设置
   - 场景配置管理

2. **顶部面板控制** (`topPanel.js`)
   - 功能模块切换
   - 3D模型加载管理
   - 底图样式控制
   - 空间分析工具
   - 天气效果模拟

3. **鹰眼地图** (`hawkEyeMap.js`)
   - 小地图导航
   - 位置定位

4. **数据配置** (`config.js`, `data.js`)
   - 默认视图参数
   - 动漫圣地数据
   - 系统配置

## 📁 项目结构

```
日本动漫圣地巡礼可视化/
├── index.html              # 主页面
├── css/
│   └── style.css          # 样式文件
├── js/
│   ├── config.js          # 配置文件
│   ├── data.js            # 动漫数据
│   ├── viewer.js          # Cesium视图管理
│   ├── locations.js       # 地点管理
│   ├── ui.js              # UI交互管理
│   ├── topPanel.js        # 顶部面板控制
│   ├── hawkEyeMap.js      # 鹰眼地图
│   ├── postProcessController.js # 后处理控制
│   └── main.js            # 主程序入口
├── image/
│   └── xmut-logo.png      # 项目Logo
├── README.md              # 项目说明
└── 项目介绍.md            # 详细项目介绍
```

## 🎯 功能特性

### 3D Tiles模型管理
- **千代田3D Tiles**: 23个高精度数据集，包含LOD1-LOD3不同精度级别
- **建筑高度可视化**: 六个高度区间的颜色映射（≥100m红色、≥50m橙色、≥30m黄色、≥15m黄绿色、≥8m绿色、<8m蓝色）
- **智能颜色分类**: 根据模型类型自动分配主题色彩
- **实时加载**: 基于视角的动态数据加载，优化性能表现

### OSM模型集成
- **建筑模型**: OpenStreetMap建筑数据的3D可视化
- **一键添加/移除**: 简单的模型管理操作

### 空间分析工具
- **缓冲区分析**: 指定半径的缓冲区生成
- **距离测量**: 精确的3D空间距离计算
- **面积测量**: 多边形区域面积计算
- **清除分析**: 一键清除所有分析结果

### 天气模拟系统
- **雨天效果**: 逼真的降雨粒子系统
- **雪天效果**: 飘雪动画效果
- **晴天模式**: 清晰的默认天气状态

### 巡礼工具
- **圣地巡礼地点**: 内置东京知名动漫取景地数据
- **地点收藏**: 个人感兴趣地点的收藏管理
- **笔记系统**: 地点相关的个人笔记功能
- **我的收藏**: 收藏地点的统一管理
- **导出数据**: 支持数据导出功能

## 🚀 快速开始

### 环境要求
- 现代浏览器（Chrome、Firefox、Safari、Edge）
- 稳定的网络连接（用于加载Cesium资源和地图数据）
- Python 3.x（用于本地服务器）

### 安装步骤

1. **克隆项目**
   ```bash
   git clone [项目地址]
   cd 日本动漫圣地巡礼可视化
   ```

2. **配置Cesium Token**
   - 打开 `js/config.js` 文件
   - 确认 `CESIUM_TOKEN` 已正确设置
   - 如需更换Token，请访问 [Cesium Ion](https://cesium.com/ion/) 获取

3. **启动本地服务器**
   ```bash
   # 使用Python启动HTTP服务器
   python -m http.server 8000
   
   # 或使用其他服务器
   npx http-server
   php -S localhost:8000
   ```

4. **访问应用**
   - 打开浏览器访问 `http://localhost:8000`
   - 开始您的动漫圣地巡礼之旅！

## 🎮 使用指南

### 基本操作
- **鼠标左键拖拽**: 旋转地球
- **鼠标右键拖拽**: 平移视图
- **鼠标滚轮**: 缩放视图
- **双击**: 飞行到指定位置

### 功能面板
1. **3D Tiles模型**: 加载/清除千代田3D Tiles
2. **OSM模型**: 添加/移除OpenStreetMap建筑模型
3. **底图样式**: 切换不同的地图底图（OpenStreetMap底图需连接国外VPN）
4. **空间分析**: 使用各种空间分析工具
5. **相机视角**: 切换2D/2.5D/3D视角模式
6. **天气模拟**: 体验不同的天气效果
7. **巡礼工具**: 探索动漫圣地和管理收藏

## 🔧 技术实现细节

### 建筑高度渐变可视化
- **属性兼容性**: 支持多种高度属性名称（`bldg:measuredHeight`、`measuredHeight`、`height`、`Height`、`HOEHE`）
- **条件样式表达式**: 使用Cesium 3D Tile Style的条件表达式实现动态颜色渲染
- **调试机制**: 内置瓦片加载监听器，自动输出可用属性信息便于调试

### 智能联动机制
- **自动底图切换**: 千代田3D Tiles加载成功后自动调用`setBasemap('stadia-dark')`
- **异步加载优化**: 23个3D Tiles数据集并行加载，提升加载效率
- **性能优化配置**: 设置合适的`maximumScreenSpaceError`、`skipLevelOfDetail`等参数
- **错误处理**: 完善的异常捕获和用户反馈机制

## 🎨 自定义配置

### 添加新的动漫数据

在 `js/data.js` 文件中添加新的动漫信息：

```javascript
ANIME_DATA['new_anime'] = {
    id: 'new_anime',
    title: '动漫名称',
    titleEn: 'Anime Title',
    year: 2023,
    director: '导演名',
    description: '动漫描述',
    locations: [
        {
            id: 'location_id',
            name: '地点名称',
            nameEn: 'Location Name',
            description: '地点描述',
            longitude: 139.7000,
            latitude: 35.6900,
            address: '详细地址',
            scenes: ['场景1', '场景2'],
            visitInfo: {
                openTime: '开放时间',
                admission: '门票信息',
                transportation: '交通信息'
            }
        }
    ]
};
```

### 修改视觉样式

在 `js/config.js` 中可以调整：
- 标记点颜色和大小
- 飞行动画时长
- 相机高度偏移
- UI显示选项

## 📱 响应式设计

项目采用响应式设计，支持多种设备：
- **桌面端**: 完整功能体验
- **平板端**: 优化的触控交互
- **移动端**: 简化的界面布局

## 🔍 应用场景

- **城市规划**: 辅助城市规划设计和方案展示
- **教育培训**: 地理信息系统教学和实践
- **旅游导览**: 虚拟城市游览和景点介绍
- **应急管理**: 灾害模拟和应急预案制定
- **房地产**: 区域环境展示和项目推广
- **文化传播**: 动漫文化和城市文化推广

## 🏆 技术优势

1. **开源技术栈**: 基于开源技术，降低开发和维护成本
2. **标准数据格式**: 采用国际标准的3D Tiles和CityGML格式
3. **高性能渲染**: Cesium引擎的WebGL优化渲染
4. **跨平台兼容**: 支持主流浏览器和操作系统
5. **可扩展架构**: 便于添加新功能和数据源
6. **智能化交互**: 实现模型与底图的智能联动，提升用户体验

## 🔮 未来发展方向

### 数据扩展
- 集成更多日本城市区域的3D数据（涩谷、新宿、秋叶原等动漫热门区域）
- 添加实时数据接口（交通流量、天气状况、人流密度等）
- 集成更多动漫作品的取景地数据和场景重现

### 功能增强
- **建筑属性优化**: 完善建筑高度属性的自动识别和映射机制
- **样式定制**: 提供用户自定义颜色方案和透明度设置
- **智能联动扩展**: 实现更多模型类型与底图样式的智能匹配
- **性能优化**: 进一步优化大规模3D Tiles的加载和渲染性能

### 平台扩展
- 增强移动端适配和触控交互体验
- 支持VR/AR设备的沉浸式体验
- 集成AI分析功能（建筑识别、场景匹配等）
- 多用户协作功能和社交分享机制

## 🤝 贡献指南

欢迎提交Issue和Pull Request来改进项目：

1. Fork项目
2. 创建特性分支 (`git checkout -b feature/AmazingFeature`)
3. 提交更改 (`git commit -m 'Add some AmazingFeature'`)
4. 推送到分支 (`git push origin feature/AmazingFeature`)
5. 创建Pull Request

## 📄 许可证

本项目仅供学习和研究使用。动漫作品版权归原作者所有。

## 🙏 致谢

- [Cesium](https://cesium.com/) - 提供强大的3D地球引擎
- [千代田区](https://www.geospatial.jp/ckan/dataset/plateau-13101-chiyoda-ku-2023) - 提供官方CityGML数据，其他地区3D Tiles数据可自行下载
- 开源社区的贡献者们

## 📞 联系方式

- **项目维护者**: 张光卫 (2212001107)
- **GitHub**: [https://github.com/SionFelix100/SeiChiJunRei]
- **邮箱**: [1639947757@qq.com]

### 注意事项
- 千代田3D Tiles模型数据存放于我的阿里云OSS存储服务中，需要通过OSS的URL进行访问。
- 如遇到千代田3D Tiles模型数据加载失败或显示异常的情况，原因则为本人的阿里云OSS存储服务已经停止维护，请谅解。
- 本项目不存储用户上传的3D模型数据，所有模型数据均来自官方CityGML数据。

---

**开始您的动漫圣地巡礼之旅吧！** 🗾✨

*本项目展示了现代Web3D技术在数字城市可视化领域的应用潜力，为智慧城市建设提供了有力的技术支撑。*D